<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>工具彙總</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
:root{
  --bg: #1e1b24;
  --panel: #2a2535;
  --card: #231f30;
  --primary: #b39ddb;
  --soft: rgba(179,157,219,0.12);
  --text: #e6e1ee;
  --muted: #a89fc2;
  
  --nogi: #7e1083;
  --sakura: #f19db5;
  --hinata: #7cc7e8;
}

*{box-sizing:border-box;font-family:Roboto,system-ui}

/* 禁止 Body 滾動，改由內部區塊滾動 */
body{
  margin:0;
  height:100vh;
  display:flex;
  background:var(--bg);
  color:var(--text);
  overflow:hidden; 
}

/* =========================================
   Sidebar (側邊欄)
   ========================================= */
.sidebar{
  width:260px;
  background:var(--panel);
  display:flex;
  flex-direction:column;
  box-shadow:2px 0 12px rgba(0,0,0,.4);
  transition:.35s;
  flex-shrink: 0;
  z-index: 40;
  height: 100vh; /* 確保佔滿全高 */
  overflow: hidden; /* ★關鍵修正：禁止側欄整體滾動，確保 Footer 不會跑出去 */
}

.sidebar-header {
  padding: 16px;
  flex-shrink: 0;
}

/* 導航區佔據剩餘空間並可滾動 */
.sidebar-nav { 
  flex: 1; 
  overflow-y: auto; /* 內容過長時，只有這一塊會滾動 */
  padding: 0 16px;
  min-height: 0; /* ★關鍵修正：防止 Flex 子元素在某些瀏覽器撐開父容器 */
  scrollbar-width: thin;
  scrollbar-color: var(--muted) transparent;
}

/* Footer 固定在底部 */
.sidebar-footer { 
  padding: 16px; 
  border-top: 1px solid rgba(255,255,255,0.05); 
  flex-shrink: 0; /* 禁止被壓縮 */
  background: var(--panel); 
  z-index: 2;
}

.logo{
  height:56px;
  border-radius:14px;
  background:linear-gradient(135deg,#9575cd,#b39ddb);
  display:flex; align-items:center; justify-content:center;
  font-weight:600; color: #fff; letter-spacing: 1px; margin-bottom: 12px;
}

.nav-item{
  padding:12px 14px; border-radius:14px; cursor:pointer;
  transition: 0.2s; color: var(--muted); font-weight: 500; margin-bottom: 4px;
}
.nav-item:hover{background:var(--soft); color: var(--primary);}

.desktop-report-btn {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  width: 100%; padding: 12px;
  background: var(--card); border: 1px solid rgba(179,157,219,0.3);
  color: var(--text); border-radius: 12px; text-decoration: none;
  font-size: 14px; transition: 0.2s;
}
.desktop-report-btn:hover {
  background: var(--primary); color: var(--bg); border-color: var(--primary);
}

/* =========================================
   Main Content (主內容)
   ========================================= */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
  position: relative;
  min-width: 0;
  height: 100vh; /* 限制高度，強制內部滾動 */
}

.topbar{
  flex-shrink: 0; /* 禁止被壓縮 */
  height:64px;
  background:var(--panel);
  display:flex; align-items:center; gap:16px; padding:0 24px;
  box-shadow:0 2px 10px rgba(0,0,0,.4);
  z-index: 30;
}

.title{flex:1;font-size:18px; font-weight: 500;}

.filter-bar {
  flex-shrink: 0; /* 禁止被壓縮 */
  background: var(--bg); padding: 12px 12px; display: flex; gap: 12px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  overflow-x: auto; white-space: nowrap; z-index: 29;
}
.filter-bar::-webkit-scrollbar { display: none; }

.filter-btn {
  background: var(--card); border: 1px solid rgba(255,255,255,0.1);
  color: var(--muted); padding: 8px 16px; border-radius: 99px;
  cursor: pointer; display: flex; align-items: center; gap: 8px;
  font-size: 14px; transition: 0.2s;
}
.filter-btn img { height: 18px; width: auto; opacity: 0.7; transition: 0.2s; }
.filter-btn:hover { background: var(--soft); color: var(--text); }
.filter-btn:hover img { opacity: 1; }
.filter-btn.active { background: var(--text); color: var(--bg); border-color: var(--text); font-weight: 600; }

.search{ width:0; overflow:hidden; transition:.2s; }
.search.open{width:220px}
.search-wrap{
  position:relative; background:var(--card); border-radius:999px;
  overflow:hidden; border:2px solid #d7b8e6; display: flex; align-items: center;
}
.search-wrap input{
  width:100%; padding:8px 34px 8px 16px; border:none; outline:none;
  background:transparent; color:var(--text); border-radius:0;
}
.clear-btn{
  position:absolute; right:10px; font-size:16px; color:var(--muted);
  cursor:pointer; display:none;
}
.search-wrap.has-text .clear-btn{display:block;}

.content{
  flex:1;
  overflow-y:auto; 
  padding:24px;
  scroll-behavior: smooth;
  position: relative;
}

.container {
  max-width: 1000px;
  margin: 0 auto;
  padding-bottom: 100px;
}

/* Sections & Cards */
.section{margin-bottom:0px; scroll-margin-top: 0px;}
.section.hidden { display: none; }
.section h2{ color:var(--primary); border-left: 4px solid var(--primary); padding-left: 12px; margin-bottom: 20px; }
.tool-grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:20px; }

.tool-card {
  background:var(--card); border-radius:18px; padding:16px;
  box-shadow:0 6px 18px rgba(0,0,0,.2); transition:.3s;
  display: flex; flex-direction: column; border: 1px solid transparent;
}
.tool-card.hidden { display: none !important; }
.tool-card:hover { transform: translateY(-4px); box-shadow:0 10px 25px rgba(0,0,0,.4); border-color: rgba(179,157,219,0.3); }
.tool-card.highlight{ outline:2px solid var(--primary); background:#332d42; }

.tool-header{ display:flex; justify-content: space-between; align-items: flex-start; gap:12px; }
.tool-info { flex: 1; }
.tool-name a{ color:var(--text); font-size: 16px; font-weight:600; text-decoration:none; transition: color 0.2s; }
.tool-name a:hover{ color:var(--primary); }
.tool-note{ font-size:13px; color:var(--muted); margin-top:4px; line-height: 1.4; word-break: break-all;}

.expand-wrap{ display:flex; flex-direction:column; align-items:flex-end; gap:16px; }
.expand-meta{ display:flex; gap:6px; }
.dot{ width:9px; height:9px; border-radius:50%; display:inline-block; }
.dot.blue{background:var(--hinata);}
.dot.purple{background:var(--nogi);}
.dot.pink{background:var(--sakura);}
.expand{ cursor:pointer; color:var(--primary); padding: 4px; border-radius: 50%; transition: 0.3s; display: flex; align-items: center; justify-content: center; }
.expand:hover { background: rgba(255,255,255,0.05); }
.tool-detail{ margin-top:12px; padding-top:12px; border-top:1px solid rgba(255,255,255,.08); display:none; font-size:14px; color: var(--muted); line-height:1.6; }

/* =========================================
   Mobile & Floating Buttons
   ========================================= */
.sidebar {
  position: fixed; height: 100%; left: 0; top: 0; transform: translateX(-100%);
}
.sidebar.open { transform: translateX(0); }

.menu-btn, .top-btn{
  position:fixed; width:52px; height:52px; border-radius:50%;
  background:var(--primary); color:#1e1b24; display:flex; align-items:center; justify-content:center;
  cursor:pointer; box-shadow:0 6px 18px rgba(0,0,0,.5); z-index:50;
  transition: transform 0.2s, background 0.2s;
}
.menu-btn:hover, .top-btn:hover { transform: scale(1.1); background: #d1c4e9; }
.menu-btn{bottom:24px;left:24px}
.top-btn{ bottom:24px; right:24px; display:none; }

.mobile-feedback-btn {
  position: fixed; bottom: 24px; left: 24px; height: 52px;
  padding: 0 24px 0 60px; background: var(--card); border: 1px solid rgba(179,157,219,0.5);
  color: var(--text); border-radius: 99px; display: flex; align-items: center; gap: 8px;
  font-size: 14px; font-weight: 500; text-decoration: none; z-index: 49; opacity: 0;
  transform: translateX(0) scale(0.9); pointer-events: none;
  transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.mobile-feedback-btn:hover { background: var(--soft); color: var(--primary); }
body.menu-open .mobile-feedback-btn { opacity: 1; transform: translateX(10px) scale(1); pointer-events: auto; box-shadow: 4px 0 15px rgba(0,0,0,0.3); }

/* =========================================
   Desktop UI Overrides
   ========================================= */
@media(min-width:1024px){
  .sidebar {
    position: relative; transform: none !important; width: 280px; height: 100vh;
  }
  .menu-btn { display: none; }
  .mobile-feedback-btn { display: none !important; }
  .desktop-only { display: flex !important; }
}
@media(max-width:1023px){
  .desktop-only { display: none !important; }
}
</style>
</head>

<body>

<aside class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="logo">TOOLKIT</div>
    <div style="height:1px;background:rgba(255,255,255,.12)"></div>
  </div>

  <div class="sidebar-nav" id="navContainer">
    </div>

  <div class="sidebar-footer">
    <a href="#" class="desktop-report-btn desktop-only" target="_blank">
      <span class="material-icons" style="font-size:18px">feedback</span>
      <span>報告/意見</span>
    </a>
  </div>
</aside>

<main class="main">
  <header class="topbar">
    <div class="title">坂道工具彙總</div>
    <div class="search" id="search">
      <div class="search-wrap">
        <input id="searchInput" placeholder="搜尋工具…">
        <span class="material-icons clear-btn" onclick="clearSearch()">close</span>
      </div>
    </div>
    <span class="material-icons" style="cursor:pointer; color:var(--text)" onclick="toggleSearch()">search</span>
  </header>

  <div class="filter-bar">
    <button class="filter-btn active" onclick="filterTools('all', this)">
      <span class="material-icons" style="font-size:18px">grid_view</span> 全部
    </button>
    <button class="filter-btn" onclick="filterTools('purple', this)">
      <img src="https://www.nogizaka46.com/files/46/page/31thSG_ul_xF2c/images/logo.svg" class="invert" alt="Nogi"> 乃木坂46
    </button>
    <button class="filter-btn" onclick="filterTools('pink', this)">
      <img src="https://sakurazaka46.com/files/14/s46/img/com-logo-no-framed.svg" class="invert" alt="Sakura"> 櫻坂46
    </button>
    <button class="filter-btn" onclick="filterTools('blue', this)">
      <img src="https://cdn.hinatazaka46.com/files/14/hinata/pages/4th_anniv/images/logo_hinata.svg" class="invert" alt="Hinata"> 日向坂46
    </button>
    <button class="filter-btn" onclick="filterTools('other', this)">
      <span class="material-icons" style="font-size:18px">more_horiz</span> 其他
    </button>
  </div>

  <section class="content" id="content">
    <div class="container" id="contentContainer">
      </div>
  </section>
</main>

<div class="menu-btn" onclick="toggleMenu()">
  <span class="material-icons">menu</span>
</div>

<a href="#" class="mobile-feedback-btn" target="_blank">
  <span class="material-icons">feedback</span>
  <span>報告/意見</span>
</a>

<div class="top-btn" id="topBtn" onclick="goTop()">
  <span class="material-icons">arrow_upward</span>
</div>

<script>
const db = [
  {
    id: "ch1",
    title: "置頂推薦",
    items: [
      { name: "坂道博客翻譯", link: "https://blog.sakamichi-tools.cn/#all", note: "blog.sakamichi-tools.cn", desc: "整合三團 Blog 翻譯的強大工具。", colors: ["purple", "pink", "blue"] },
      { name: "工具 B (範例)", link: "#", note: "紫色與藍色", desc: "這是一個測試工具說明。", colors: ["purple", "blue"] }
    ]
  },
  {
    id: "ch2",
    title: "聖地巡礼",
    items: [
      { name: "乃木地圖 | Nogimap", link: "https://nogimap.com/", note: "nogimap.com", desc: "乃木坂46 專屬聖地巡禮地圖。", colors: ["purple"] },
      { name: "日向坂46 聖地map", link: "#", note: "Google Maps", desc: "太陽公公們的足跡。", colors: ["blue"] }
    ]
  },
  {
    id: "ch3",
    title: "數據資料",
    items: [
      { name: "櫻坂數據庫", link: "#", note: "Data Store", desc: "詳細的銷售數據與排名。", colors: ["pink"] }
    ]
  },
  {
    id: "ch4",
    title: "其他工具",
    items: [
      { name: "系統監控", link: "#", note: "Monitor", desc: "伺服器狀態監控面板。", colors: [] }
    ]
  }
];

const contentContainer = document.getElementById('contentContainer');
const contentEl = document.getElementById('content');
const navContainer = document.getElementById('navContainer');
const sidebar = document.getElementById('sidebar');
const body = document.body;

function render() {
  let contentHtml = "";
  let navHtml = `<div class="nav-item" onclick="goTop()">Top</div>`;

  db.forEach(section => {
    navHtml += `<div class="nav-item" onclick="go('${section.id}')">${section.title}</div>`;

    let cardsHtml = "";
    section.items.forEach(tool => {
      let dotsHtml = "";
      let tags = "";
      if(tool.colors && tool.colors.length > 0){
        tags = tool.colors.join(" ");
        tool.colors.forEach(c => { dotsHtml += `<span class="dot ${c}"></span>`; });
      }
      cardsHtml += `
        <div class="tool-card" data-tags="${tags}">
          <div class="tool-header">
            <div class="tool-info">
              <div class="tool-name"><a href="${tool.link}" target="_blank">${tool.name}</a></div>
              <div class="tool-note">${tool.note}</div>
            </div>
            <div class="expand-wrap">
              <div class="expand-meta">${dotsHtml}</div>
              <div class="expand" onclick="toggleDetail(this)"><span class="material-icons">expand_more</span></div>
            </div>
          </div>
          <div class="tool-detail">${tool.desc}</div>
        </div>
      `;
    });

    contentHtml += `
      <div class="section" id="${section.id}">
        <h2>${section.title}</h2>
        <div class="tool-grid">${cardsHtml}</div>
      </div>
    `;
  });

  contentContainer.innerHTML = contentHtml;
  navContainer.innerHTML = navHtml;
}

render();

function toggleMenu() {
  const isOpen = sidebar.classList.contains('open');
  if (isOpen) {
    sidebar.classList.remove('open');
    body.classList.remove('menu-open');
  } else {
    sidebar.classList.add('open');
    body.classList.add('menu-open');
  }
}

contentEl.addEventListener('click', () => {
  if(window.innerWidth < 1024 && sidebar.classList.contains('open')){
    toggleMenu();
  }
});

function go(id){
  const el = document.getElementById(id);
  if(el){
    el.scrollIntoView({behavior:'smooth'});
    // 點擊側欄項目跳轉後，如果是手機版且側欄打開，則關閉側欄
    if(window.innerWidth < 1024 && sidebar.classList.contains('open')) toggleMenu();
  }
}

function goTop(){
  contentEl.scrollTo({top:0,behavior:'smooth'});
  // ★關鍵修正：只有當側欄是「打開」的狀態，才執行關閉。避免點擊懸浮鈕時誤開側欄。
  if(window.innerWidth < 1024 && sidebar.classList.contains('open')) {
    toggleMenu();
  }
}

function toggleDetail(el){
  const card = el.closest('.tool-card');
  const detail = card.querySelector('.tool-detail');
  const icon = el.querySelector('span.material-icons');
  const isOpen = detail.style.display === 'block';
  detail.style.display = isOpen ? 'none' : 'block';
  icon.textContent = isOpen ? 'expand_more' : 'expand_less';
}

const searchBox = document.getElementById('search');
const searchInput = document.getElementById('searchInput');
let lastIndex=0;
function toggleSearch(){
  searchBox.classList.toggle('open');
  if(searchBox.classList.contains('open')) searchInput.focus();
}
function clearSearch(){
  searchInput.value='';
  searchInput.focus();
  searchInput.parentElement.classList.remove('has-text');
  document.querySelectorAll('.tool-card.highlight').forEach(c=>c.classList.remove('highlight'));
  lastIndex=0;
}
searchInput.addEventListener('input',()=>{
  searchInput.parentElement.classList.toggle('has-text', searchInput.value.length>0);
});
searchInput.addEventListener('keydown',e=>{
  if(e.key!=='Enter') return;
  const q=searchInput.value.trim().toLowerCase();
  if(!q) return;
  const cards=[...document.querySelectorAll('.tool-card:not(.hidden)')];
  cards.forEach(c=>c.classList.remove('highlight'));
  const hits=cards.filter(c=>c.innerText.toLowerCase().includes(q));
  if(!hits.length) return;
  const card=hits[lastIndex % hits.length];
  lastIndex++;
  card.classList.add('highlight');
  card.scrollIntoView({behavior:'smooth', block:'center'});
});

function filterTools(color, btn) {
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const cards = document.querySelectorAll('.tool-card');
  cards.forEach(card => {
    const tags = card.getAttribute('data-tags') || "";
    let isVisible = (color === 'all') || 
                    (color === 'other' && tags === "") || 
                    (tags.includes(color));
    card.classList.toggle('hidden', !isVisible);
  });
  document.querySelectorAll('.section').forEach(section => {
    const visibleCards = section.querySelectorAll('.tool-card:not(.hidden)');
    section.classList.toggle('hidden', visibleCards.length === 0);
  });
}

const topBtn = document.getElementById('topBtn');
contentEl.addEventListener('scroll', () => {
  topBtn.style.display = contentEl.scrollTop > 300 ? 'flex' : 'none';
});

</script>

</body>
</html>
